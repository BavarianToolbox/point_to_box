---

title: utils


keywords: fastai
sidebar: home_sidebar

summary: "Utility functions for the _point_to_box_ package."
description: "Utility functions for the _point_to_box_ package."
nb_path: "nbs/00_utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/00_utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_norm_stats" class="doc_header"><code>get_norm_stats</code><a href="https://github.com/BavarianToolbox/point_to_box/tree/master/point_to_box/utils.py#L14" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_norm_stats</code>(<strong><code>loaders</code></strong>)</p>
</blockquote>
<p>Returns normalization stats (mean and std) computed across one or more image dataloaders.</p>
<p><strong>Parameters</strong></p>
<p>loaders : list of pytorch dataloaders</p>
<p><strong>Returns</strong></p>
<p>list of stats as pytorch tensors</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="draw_rect" class="doc_header"><code>draw_rect</code><a href="https://github.com/BavarianToolbox/point_to_box/tree/master/point_to_box/utils.py#L43" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>draw_rect</code>(<strong><code>im</code></strong>, <strong><code>cords</code></strong>, <strong><code>box_format</code></strong>=<em><code>None</code></em>, <strong><code>color</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Draw one or more rectangls on an image.</p>
<p><strong>Parameters</strong></p>
<p>im : numpy image [W, H, C]</p>
<p>cords : Numpy array containing N bounding boxes [N, 4]</p>
<p>box_format : String indicating bbox-coordinate format</p>
<ul>
<li>coco     : [xmin, ymin, w, h]</li>
<li>cnt_ofst : [xofst, yofst, w, h]</li>
<li>*_frac   : as fraction of image width/height</li>
<li>None     : [xmin, ymin, xmax, ymax]</li>
</ul>
<p>color : List of one or more colors [(R, G, B)]</p>
<p><strong>Returns</strong></p>
<p>numpy image with bounding boxes drawn on it [W, H, C]</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="convert_cords" class="doc_header"><code>convert_cords</code><a href="https://github.com/BavarianToolbox/point_to_box/tree/master/point_to_box/utils.py#L129" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>convert_cords</code>(<strong><code>cords</code></strong>, <strong><code>img_dims</code></strong>, <strong><code>cord_format</code></strong>)</p>
</blockquote>
<p>Convert bounding box coordinates</p>
<p><strong>Parameters</strong></p>
<p>cords : list of bbox coordinates [xmin, ymin, w, h]</p>
<p>img_dims : Image dimensions (w, h) as list or tuple</p>
<p>cord_format : Coordinate conversion format</p>
<ul>
<li>cnt_ofst         : [xofst, yofst, w, h]</li>
<li>cntr_ofst_frac   : [xofst, yofst, w, h] as fraction of image width/height</li>
<li>corner_ofst_frac : [xmin, min, w, h] as fraction of image width/height</li>
</ul>
<p><strong>Returns</strong></p>
<p>List of converted box coordinates</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="resize" class="doc_header"><code>resize</code><a href="https://github.com/BavarianToolbox/point_to_box/tree/master/point_to_box/utils.py#L171" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>resize</code>(<strong><code>size</code></strong>, <strong><code>img</code></strong>, <strong><code>bbox</code></strong>)</p>
</blockquote>
<p>Resize an image in accordance to 'image_letter_box' function in darknet</p>
<p><strong>Params</strong></p>
<p>size : target size for the long-edge of the original image</p>
<p>img : np.ndarray image to be resized, shape HxWxC</p>
<p>bbox : np.ndarray of bounding box coordinates [xmin, ymin, xmax, ymax]</p>
<p><strong>Returns</strong></p>
<p>img : resized image as np.ndarray</p>
<p>bbox : resized bounding box np.ndarray [xmin, ymin, xmax, ymax]</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">denorm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">norm_format</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    **Params**</span>
<span class="sd">    </span>
<span class="sd">    data : image data as np array [C, W, H] or [N, C, W, H]</span>
<span class="sd">    </span>
<span class="sd">    norm_format : </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">norm_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;test&#39;</span> <span class="p">:</span>        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">]),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">])],</span>
        <span class="s1">&#39;img_net&#39;</span> <span class="p">:</span>     <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">]),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">])],</span>
        <span class="s1">&#39;img_net_4ch&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">,</span> <span class="mf">1.993e-05</span><span class="p">]),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">,</span> <span class="mf">0.0045</span><span class="p">])],</span>
        <span class="s1">&#39;surfer&#39;</span> <span class="p">:</span>      <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">5.4271e-01</span><span class="p">,</span> <span class="mf">5.7049e-01</span><span class="p">,</span> <span class="mf">5.8811e-01</span><span class="p">]),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0892</span><span class="p">,</span> <span class="mf">0.0858</span><span class="p">,</span> <span class="mf">0.0831</span><span class="p">])],</span>
        <span class="s1">&#39;surfer_4ch&#39;</span> <span class="p">:</span>  <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">5.4271e-01</span><span class="p">,</span> <span class="mf">5.7049e-01</span><span class="p">,</span> <span class="mf">5.8811e-01</span><span class="p">,</span> <span class="mf">1.9930e-05</span><span class="p">]),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0892</span><span class="p">,</span> <span class="mf">0.0858</span><span class="p">,</span> <span class="mf">0.0831</span><span class="p">,</span> <span class="mf">0.0045</span><span class="p">])]</span>
    <span class="p">}</span>
    
    <span class="n">means</span><span class="p">,</span> <span class="n">stds</span> <span class="o">=</span> <span class="n">norm_dict</span><span class="p">[</span><span class="n">norm_format</span><span class="p">]</span>
    
<span class="c1">#     if norm_format == &#39;img_net&#39;:</span>
<span class="c1">#         means = np.array([0.485, 0.456, 0.406]) </span>
<span class="c1">#         stds = np.array([0.229, 0.224, 0.225])</span>
<span class="c1">#     elif norm_format == &#39;img_net_4ch&#39;:</span>
<span class="c1">#         means = np.array([0.485, 0.456, 0.406, 1.993e-05])</span>
<span class="c1">#         stds = np.array([0.229, 0.224, 0.225, 0.0045])</span>
<span class="c1">#     elif norm_format == &#39;surfer&#39;:</span>
<span class="c1">#         means = np.array([5.4271e-01, 5.7049e-01, 5.8811e-01])</span>
<span class="c1">#         stds = np.array([0.0892, 0.0858, 0.0831])</span>
<span class="c1">#     elif norm_format == &#39;surfer_4ch&#39;:</span>
<span class="c1">#         means = np.array([5.4271e-01, 5.7049e-01, 5.8811e-01, 1.9930e-05])</span>
<span class="c1">#         stds = np.array([0.0892, 0.0858, 0.0831, 0.0045])</span>
        
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">stds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">stds</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">means</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Image dims don</span><span class="se">\&#39;</span><span class="s1">t match norm format&#39;</span>
    
<span class="c1">#     for dat, mean, std in zip(data, norm_stats[0], norm_stats[1]):</span>
<span class="c1">#         denormed.append(dat*std+mean)</span>
    
    <span class="n">denormed</span> <span class="o">=</span> <span class="n">data</span><span class="o">*</span><span class="n">means</span> <span class="c1"># - stds</span>

    <span class="k">return</span> <span class="n">denormed</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="noise" class="doc_header"><code>noise</code><a href="https://github.com/BavarianToolbox/point_to_box/tree/master/point_to_box/utils.py#L222" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>noise</code>(<strong><code>val</code></strong>, <strong><code>size</code></strong>, <strong><code>pct</code></strong>=<em><code>0.2</code></em>)</p>
</blockquote>
<p>Add noise to value</p>
<p><strong>Params</strong></p>
<p>val :  value to add noise to</p>
<p>size : relative size</p>
<p>pct :  float, percent for interval clipping</p>
<p><strong>Return</strong></p>
<p>noisy_val : original value with noise added</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_prompt_points" class="doc_header"><code>get_prompt_points</code><a href="https://github.com/BavarianToolbox/point_to_box/tree/master/point_to_box/utils.py#L246" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_prompt_points</code>(<strong><code>anns</code></strong>, <strong><code>n</code></strong>)</p>
</blockquote>
<p>Get list of object prompt points by sampeling random points in the object polygons</p>
<p><strong>Params</strong></p>
<p>anns : coco-style annotation dict</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

